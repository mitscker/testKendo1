<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <!-- kendo libreries -->
    <link href="./content/shared/styles/examples-offline.css" rel="stylesheet">
    <link href="./styles/kendo.common.min.css" rel="stylesheet">
    <link href="./styles/kendo.rtl.min.css" rel="stylesheet">
    <link href="./styles/kendo.flat.min.css" rel="stylesheet"> <!-- esto maneja el tema -->
    <link href="./styles/kendo.default.mobile.min.css" rel="stylesheet">
    <script src="./js/jquery.min.js"></script>
    <script src="./js/jszip.min.js"></script>
    <script src="./js/kendo.all.min.js"></script>
    <script src="./content/shared/js/console.js"></script>
    <link href="./styles.css" rel="stylesheet" type="text/css">
    <!-- bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script src="./jsonGrafica.js" type="text/javascript"></script>
    <title>Document</title>
</head>
<body class="container px-3" style="background-color:#fff;box-shadow:3px 3px 3px 1px rgba(0,0,0,0.3);">

    <header class="mb-5">
        <!-- menu principal -->
        <ul id="menu">
            <li id="Item1">Item 1
                <ul>
                    <li>Sub Item 1</li>
                    <li>Sub Item 2</li>
                    <li>Sub Item 3</li>
                </ul>
            </li>
            <li>Item 2
                <ul>
                    <li>Sub Item 1</li>
                    <li>Sub Item 2</li>
                    <li>Sub Item 3</li>
                </ul>
            </li>
        </ul>
    </header>

    <!-- grafica -->
    <div class="d-flex flex-row">
        <!-- primera tabla -->
        <div id="grid" class="w-50"></div>
        <div id="chart" class="w-50 ml-3"></div>
    </div>

    <!-- segunda tabla -->
    <a id="export" class="btn btn-primary mt-5 mb-2" style="color:#f4f4f4">Exportar en PDF</a>
    <div id="gridOrdenes" class="w-100 mx-auto mb-5"></div>

    <!-- otro grid -->
    <div id="gridData" class="w-100 mx-auto m-5"></div>

    <!-- visor de pdf -->
    <div id="pdfviewer" class="w-100 mx-auto m-5"></div>
    <!-- grid -->

    <!-- examples -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.2.2/pdf.js"></script>
    <script>
        window.pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.2.2/pdf.worker.js';
    </script>
    <script>
        //         //Detect browser support for CORS
        // if ('withCredentials' in new XMLHttpRequest()) {
        //     /* supports cross-domain requests */
        //     document.write("CORS supported (XHR)");
        // }
        // else{
        // if(typeof XDomainRequest !== "undefined"){
        //     //Use IE-specific "CORS" code with XDR
        //     document.write("CORS supported (XDR)");
        // }else{
        //     //Time to retreat with a fallback or polyfill
        //     document.write("No CORS Support!");
        // }
        // }

        /* menu principal  */
        $("#menu").kendoMenu();
        // get a reference to the menu widget
        var menu = $("#menu").data("kendoMenu");
        // open the sub menu of "Item1"
        // menu.open("#Item1");

        
        function createChart() {
            
            let arrayData = [{data: []}]
            console.log(data["tt-Grafica"]);
            for(let i of data["tt-Grafica"]) {
                arrayData[0].data.push(i["PU"])
            }
            console.log(arrayData);
    /* grafica */
        $("#chart").kendoChart({
            title: {
                text: "IPC"
            },
            legend: {
                visible: false
            },
            seriesDefaults: {
                type: "line",
                stack: false
            },
            dataSource: {
                data: data["tt-Grafica"]
            },
            series: [{
                field: "PU"
            }],
            valueAxis: {
                max: 43500,
                min: 43200,
                line: {
                    visible: false
                },
                minorGridLines: {
                    visible: false
                }
            },
            categoryAxis: {
                categories: [],
                majorGridLines: {
                    visible: false
                }
            },
            tooltip: {
                visible: true,
                template: "#= dataItem.Fecha # <br /> #= value #"
            }
            });
        }

        /* visor de pdf */
        $(document).ready(function() {
            $("#pdfviewer").kendoPDFViewer({
                pdfjsProcessing: {
                    file: ".//content//web//pdfViewer//sample.pdf"
                },
                width: "80%",
                height: 800,
                toolbar: {
                    items: [
                        "pager",
                        "spacer",
                        "download",
                        "print"
                    ]
                }
            })
        })

        /* grid */ 
        $("#grid").kendoGrid({
            columns: [
            { field: "name" },
            { field: "age" },
            { command: [
                { 
                    name: "Comprar",
                    click: function() {
                        alert('Comprando..')
                    },
                    iconClass: "k-icon k-i-dollar"
                },
                {
                    name: "Vender",
                    click: function() {
                        alert('Vendiendo..')
                    },
                    iconClass: "k-icon k-i-invert-colors"
                }
            ] }
            ],
            dataSource: {
            data: [
                { id: 1, name: "Jane Doe", age: 30 },
                { id: 2, name: "John Doe", age: 33 }
            ],
            schema: {
                model: { id: "id" }
            }
            },
            sortable: true,
            sort: function(e) {
            console.log(e.sort.field);
            console.log(e.sort.dir);
            }
        });
        /* gridOrdenes */ 
        $("#gridOrdenes").kendoGrid({
            columns: [
                { field: "id" },
                { field: "Tipo" },
                { field: "Costo" }
            ],
            dataSource: {
            data: [
                { id: 1, Tipo: "Compra", Costo: 22.34 },
                { id: 2, Tipo: "Compra", Costo: 30 },
                { id: 3, Tipo: "Venta", Costo: 30 },
                { id: 4, Tipo: "Compra", Costo: 22.34 },
                { id: 5, Tipo: "Venta", Costo: 30 },
                { id: 6, Tipo: "Venta", Costo: 22.34 },
                { id: 7, Tipo: "Compra", Costo: 30 },
                { id: 8, Tipo: "Compra", Costo: 22.34 },
                { id: 9, Tipo: "Venta", Costo: 33 }
            ],
            schema: {
                model: { id: "id" }
            }
            },
            sortable: true,
            sort: function(e) {
            console.log(e.sort.field);
            console.log(e.sort.dir);
            }
        });

        $("#export").click(function(e) {
            let grid = $("#gridOrdenes").data("kendoGrid")
            grid.saveAsPDF()
        })

        /* grid data */
        var orderData = [
            { OrderID: 1, OrderDate: "2017-11-06T12:00:00", Freight: 12.34, ShipCity: "Antwerp", ShipCountry: "Belgium" },
            { OrderID: 2, OrderDate: "2019-03-02T12:00:00", Freight: 23.45, ShipCity: "Singapore", ShipCountry: "Singapore" },
            { OrderID: 3, OrderDate: "2019-06-26T12:00:00", Freight: 34.56, ShipCity: "Shanghai", ShipCountry: "China" },
            { OrderID: 4, OrderDate: "2017-09-20T12:00:00", Freight: 45.67, ShipCity: "Hamburg", ShipCountry: "Germany" },
            { OrderID: 5, OrderDate: "2017-12-12T12:00:00", Freight: 56.78, ShipCity: "Mumbai", ShipCountry: "India" },
            { OrderID: 6, OrderDate: "2018-02-08T12:00:00", Freight: 67.89, ShipCity: "Shanghai", ShipCountry: "China" },
            { OrderID: 7, OrderDate: "2018-05-05T12:00:00", Freight: 78.90, ShipCity: "Tokyo", ShipCountry: "Japan" },
            { OrderID: 8, OrderDate: "2019-08-03T12:00:00", Freight: 89.01, ShipCity: "Port Klang", ShipCountry: "Malaysia" },
            { OrderID: 9, OrderDate: "2018-10-29T12:00:00", Freight: 90.12, ShipCity: "Rotterdam", ShipCountry: "Netherlands" },
            { OrderID: 10, OrderDate: "2018-01-23T12:00:00", Freight: 10.32, ShipCity: "Vancouver", ShipCountry: "Canada" },
            { OrderID: 11, OrderDate: "2018-04-17T12:00:00", Freight: 21.43, ShipCity: "Col√≥n", ShipCountry: "Panama" },
            { OrderID: 12, OrderDate: "2017-07-11T12:00:00", Freight: 32.54, ShipCity: "Manila", ShipCountry: "Philippines" },
            { OrderID: 13, OrderDate: "2017-10-24T12:00:00", Freight: 43.65, ShipCity: "Singapore", ShipCountry: "Singapore" },
            { OrderID: 14, OrderDate: "2018-03-11T12:00:00", Freight: 54.76, ShipCity: "Busan", ShipCountry: "South Korea" },
            { OrderID: 15, OrderDate: "2018-06-17T12:00:00", Freight: 65.87, ShipCity: "Shenzhen", ShipCountry: "China" },
            { OrderID: 16, OrderDate: "2018-10-13T12:00:00", Freight: 76.98, ShipCity: "Hong Kong", ShipCountry: "China" },
            { OrderID: 17, OrderDate: "2019-04-19T12:00:00", Freight: 87.09, ShipCity: "Dubai", ShipCountry: "UAE" },
            { OrderID: 18, OrderDate: "2019-07-25T12:00:00", Freight: 98.21, ShipCity: "Felixstowe", ShipCountry: "UK" },
            { OrderID: 19, OrderDate: "2017-09-22T12:00:00", Freight: 13.24, ShipCity: "Los Angeles", ShipCountry: "USA" },
            { OrderID: 20, OrderDate: "2018-12-09T12:00:00", Freight: 35.46, ShipCity: "New York", ShipCountry: "USA" },
            { OrderID: 21, OrderDate: "2018-02-04T12:00:00", Freight: 57.68, ShipCity: "Guangzhou", ShipCountry: "China" },
            { OrderID: 22, OrderDate: "2019-05-16T12:00:00", Freight: 9.87, ShipCity: "Long Beach", ShipCountry: "USA" },
            { OrderID: 23, OrderDate: "2019-08-18T12:00:00", Freight: 24.13, ShipCity: "Singapore", ShipCountry: "Singapore" }
            ];

            var gridDataSource = new kendo.data.DataSource({
                data: orderData,
                schema: {
                    model: {
                    fields: {
                        OrderID: { type: "number" },
                        Freight: { type: "number" },
                        OrderDate: { type: "date" },
                        ShipCountry: { type: "string" },
                        ShipCity: { type: "string" }
                    }
                    }
                },
                pageSize: 10,
                sort: {
                    field: "OrderDate",
                    dir: "desc"
                }
            });

            $("#gridData").kendoGrid({
                dataSource: gridDataSource
            })

        $(document).ready(createChart);
        $(document).bind("kendo:skinChange", createChart);

    </script>
        </div>
    
</body>
</html>